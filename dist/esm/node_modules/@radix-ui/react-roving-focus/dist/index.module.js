import { useControllableState } from '../../react-use-controllable-state/dist/index.module.js';
import { useCallbackRef } from '../../react-use-callback-ref/dist/index.module.js';
import { Primitive } from '../../react-primitive/dist/index.module.js';
import { useId } from '../../react-id/dist/index.module.js';
import { createContextScope } from '../../react-context/dist/index.module.js';
import { useComposedRefs } from '../../react-compose-refs/dist/index.module.js';
import { createCollection } from '../../react-collection/dist/index.module.js';
import { composeEventHandlers } from '../../primitive/dist/index.module.js';
import * as React from 'react';
import _extends from '../../../@babel/runtime/helpers/esm/extends.js';

const f={bubbles:!1,cancelable:!0},[p,l,m]=createCollection("RovingFocusGroup"),[d,v]=createContextScope("RovingFocusGroup",[m]);const[g,F]=d("RovingFocusGroup");const RovingFocusGroup=/*#__PURE__*/React.forwardRef(((e,o)=>/*#__PURE__*/React.createElement(p.Provider,{scope:e.__scopeRovingFocusGroup},/*#__PURE__*/React.createElement(p.Slot,{scope:e.__scopeRovingFocusGroup},/*#__PURE__*/React.createElement(w,_extends({},e,{ref:o}))))));const w=/*#__PURE__*/React.forwardRef(((t,n)=>{const{__scopeRovingFocusGroup:c,orientation:p,dir:m="ltr",loop:d=!1,currentTabStopId:v,defaultCurrentTabStopId:F,onCurrentTabStopIdChange:w,onEntryFocus:b,...x}=t,E=React.useRef(null),I=useComposedRefs(n,E),[G=null,h]=useControllableState({prop:v,defaultProp:F,onChange:w}),[T,A]=React.useState(!1),y=useCallbackRef(b),D=l(c),S=React.useRef(!1);return React.useEffect((()=>{const e=E.current;if(e)return e.addEventListener("rovingFocusGroup.onEntryFocus",y),()=>e.removeEventListener("rovingFocusGroup.onEntryFocus",y)}),[y]),/*#__PURE__*/React.createElement(g,{scope:c,orientation:p,dir:m,loop:d,currentTabStopId:G,onItemFocus:React.useCallback((e=>h(e)),[h]),onItemShiftTab:React.useCallback((()=>A(!0)),[])},/*#__PURE__*/React.createElement(Primitive.div,_extends({tabIndex:T?-1:0,"data-orientation":p},x,{ref:I,style:{outline:"none",...t.style},onMouseDown:composeEventHandlers(t.onMouseDown,(()=>{S.current=!0;})),onFocus:composeEventHandlers(t.onFocus,(e=>{const o=!S.current;if(e.target===e.currentTarget&&o&&!T){const o=new Event("rovingFocusGroup.onEntryFocus",f);if(e.currentTarget.dispatchEvent(o),!o.defaultPrevented){const e=D().filter((e=>e.focusable));R([e.find((e=>e.active)),e.find((e=>e.id===G)),...e].filter(Boolean).map((e=>e.ref.current)));}}S.current=!1;})),onBlur:composeEventHandlers(t.onBlur,(()=>A(!1)))})))}));const RovingFocusGroupItem=/*#__PURE__*/React.forwardRef(((e,o)=>{const{__scopeRovingFocusGroup:n,focusable:i=!0,active:c=!1,...f}=e,m=useId(),d=F("RovingFocusGroupItem",n),v=d.currentTabStopId===m,g=l(n);return React.createElement(p.ItemSlot,{scope:n,id:m,focusable:i,active:c},/*#__PURE__*/React.createElement(Primitive.span,_extends({tabIndex:v?0:-1,"data-orientation":d.orientation},f,{ref:o,onMouseDown:composeEventHandlers(e.onMouseDown,(e=>{i?d.onItemFocus(m):e.preventDefault();})),onFocus:composeEventHandlers(e.onFocus,(()=>d.onItemFocus(m))),onKeyDown:composeEventHandlers(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void d.onItemShiftTab();if(e.target!==e.currentTarget)return;const o=function(e,o,r){const t=function(e,o){return "rtl"!==o?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,r);return "vertical"===o&&["ArrowLeft","ArrowRight"].includes(t)||"horizontal"===o&&["ArrowUp","ArrowDown"].includes(t)?void 0:b[t]}(e,d.orientation,d.dir);if(void 0!==o){e.preventDefault();let n=g().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===o)n.reverse();else if("prev"===o||"next"===o){"prev"===o&&n.reverse();const i=n.indexOf(e.currentTarget);n=d.loop?(t=i+1,(r=n).map(((e,o)=>r[(t+o)%r.length]))):n.slice(i+1);}setTimeout((()=>R(n)));}var r,t;}))})))}));const b={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function R(e){const o=document.activeElement;for(const r of e){if(r===o)return;if(r.focus(),document.activeElement!==o)return}}const Root=RovingFocusGroup;const Item=RovingFocusGroupItem;

export { Item, Root, RovingFocusGroup, RovingFocusGroupItem, v as createRovingFocusGroupScope };
