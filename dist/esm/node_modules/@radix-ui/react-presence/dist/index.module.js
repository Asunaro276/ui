import { useLayoutEffect } from '../../react-use-layout-effect/dist/index.module.js';
import { useComposedRefs } from '../../react-compose-refs/dist/index.module.js';
import * as React from 'react';

const Presence=u=>{const{present:o,children:i}=u,s=function(n){const[u,o]=React.useState(),i=React.useRef({}),s=React.useRef(n),c=React.useRef("none"),a=n?"mounted":"unmounted",[d,m]=function(e,n){return React.useReducer(((e,t)=>{const r=n[e][t];return null!=r?r:e}),e)}(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return React.useEffect((()=>{const e=r(i.current);c.current="mounted"===d?e:"none";}),[d]),useLayoutEffect((()=>{const e=i.current,t=s.current;if(t!==n){const u=c.current,o=r(e);if(n)m("MOUNT");else if("none"===o||"none"===(null==e?void 0:e.display))m("UNMOUNT");else {const e=u!==o;m(t&&e?"ANIMATION_OUT":"UNMOUNT");}s.current=n;}}),[n,m]),useLayoutEffect((()=>{if(u){const e=e=>{const n=r(i.current).includes(e.animationName);e.target===u&&n&&m("ANIMATION_END");},n=e=>{e.target===u&&(c.current=r(i.current));};return u.addEventListener("animationstart",n),u.addEventListener("animationcancel",e),u.addEventListener("animationend",e),()=>{u.removeEventListener("animationstart",n),u.removeEventListener("animationcancel",e),u.removeEventListener("animationend",e);}}m("ANIMATION_END");}),[u,m]),{isPresent:["mounted","unmountSuspended"].includes(d),ref:React.useCallback((e=>{e&&(i.current=getComputedStyle(e)),o(e);}),[])}}(o),c="function"==typeof i?i({present:s.isPresent}):React.Children.only(i),a=useComposedRefs(s.ref,c.ref);return "function"==typeof i||s.isPresent?/*#__PURE__*/React.cloneElement(c,{ref:a}):null};function r(e){return (null==e?void 0:e.animationName)||"none"}Presence.displayName="Presence";

export { Presence };
